<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ì - DBê¸€ë¡œë²Œì¹© DISC ì§„ë‹¨</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ê´€ë¦¬ì ë¡œê·¸ì¸ í™”ë©´ */
        .admin-login-screen {
            min-height: 100vh;
            background: var(--db-green-gradient);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .admin-login-container {
            background: var(--bg-primary);
            border-radius: var(--radius-lg);
            padding: 48px 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: var(--shadow-lg);
        }
        
        .admin-login-title {
            text-align: center;
            margin-bottom: 32px;
        }
        
        .admin-login-title h1 {
            color: var(--db-green-primary);
            font-size: 24px;
            margin-bottom: 8px;
        }
        
        .admin-login-title p {
            color: var(--text-muted);
            font-size: 14px;
        }
        
        .admin-login-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .admin-login-error {
            padding: 12px;
            background: #FFEBEE;
            color: #C62828;
            border-radius: var(--radius-sm);
            font-size: 14px;
            text-align: center;
            display: none;
        }
        
        /* ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ */
        .admin-dashboard {
            display: none;
            min-height: 100vh;
            background: var(--bg-secondary);
        }
        
        .admin-dashboard.active {
            display: block;
        }
        
        /* ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ */
        .btn-excel {
            padding: 10px 20px;
            background: #217346;
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            font-size: 14px;
            font-weight: 600;
            font-family: inherit;
            cursor: pointer;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-excel:hover {
            background: #1a5c38;
        }
        
        .btn-excel svg {
            width: 18px;
            height: 18px;
        }
    </style>
</head>
<body>
    <!-- ê´€ë¦¬ì ë¡œê·¸ì¸ í™”ë©´ -->
    <div id="admin-login-screen" class="admin-login-screen">
        <div class="admin-login-container">
            <div class="admin-login-title">
                <h1>ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸</h1>
                <p>DBê¸€ë¡œë²Œì¹© DISC ì§„ë‹¨ ê´€ë¦¬ í˜ì´ì§€</p>
            </div>
            <form id="admin-login-form" class="admin-login-form">
                <div id="login-error" class="admin-login-error">
                    ë¶€ì„œëª… ë˜ëŠ” ì´ë¦„ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.
                </div>
                <div class="input-group">
                    <label for="admin-department">ë¶€ì„œëª…</label>
                    <input type="text" id="admin-department" name="department" placeholder="ë¶€ì„œëª… ì…ë ¥" required>
                </div>
                <div class="input-group">
                    <label for="admin-name">ì´ë¦„ (ì‚¬ë²ˆ)</label>
                    <input type="text" id="admin-name" name="name" placeholder="ì´ë¦„ ì…ë ¥" required>
                </div>
                <button type="submit" class="btn-primary">ë¡œê·¸ì¸</button>
            </form>
            <a href="index.html" class="admin-link" style="margin-top: 24px;">â† ì§„ë‹¨ í˜ì´ì§€ë¡œ ëŒì•„ê°€ê¸°</a>
        </div>
    </div>

    <!-- ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ -->
    <div id="admin-dashboard" class="admin-dashboard">
        <div class="admin-container">
            <header class="admin-header">
                <div>
                    <h1>DBê¸€ë¡œë²Œì¹© DISC ì§„ë‹¨ ê´€ë¦¬</h1>
                    <p style="opacity: 0.9; margin-top: 4px; font-size: 14px;">ì „ì²´ ì§ì› ì§„ë‹¨ ê²°ê³¼ í˜„í™©</p>
                </div>
                <div style="display: flex; gap: 12px; align-items: center;">
                    <a href="index.html" class="admin-header-link">â† ì§„ë‹¨ í˜ì´ì§€</a>
                    <button id="logout-btn" class="admin-header-link" style="background: none; border: none; cursor: pointer;">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </header>
            
            <div class="admin-toolbar">
                <select id="sort-select">
                    <option value="date-desc">ìµœì‹ ìˆœ</option>
                    <option value="date-asc">ì˜¤ë˜ëœìˆœ</option>
                    <option value="name-asc">ì´ë¦„ìˆœ (ã„±-ã…)</option>
                    <option value="name-desc">ì´ë¦„ìˆœ (ã…-ã„±)</option>
                    <option value="dept-asc">ë¶€ì„œìˆœ</option>
                    <option value="type">ìœ í˜•ìˆœ</option>
                </select>
                <select id="type-filter">
                    <option value="all">ì „ì²´ ìœ í˜•</option>
                    <option value="D">D (ì£¼ë„í˜•)</option>
                    <option value="I">I (ì‚¬êµí˜•)</option>
                    <option value="S">S (ì•ˆì •í˜•)</option>
                    <option value="C">C (ì‹ ì¤‘í˜•)</option>
                </select>
                <button class="btn-excel" id="download-excel">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                    </svg>
                    ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
                </button>
                <button class="btn-secondary" id="clear-data" style="padding: 10px 16px; font-size: 14px;">
                    ë°ì´í„° ì´ˆê¸°í™”
                </button>
                <div class="stats">
                    ì´ <strong id="total-count">0</strong>ëª… ì§„ë‹¨ ì™„ë£Œ
                </div>
            </div>
            
            <div class="admin-table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>ì´ë¦„</th>
                            <th>ë¶€ì„œëª…</th>
                            <th>ì§„ë‹¨ì¼ì‹œ</th>
                            <th>DISC ìœ í˜•</th>
                            <th>í•˜ìœ„ ìœ í˜•</th>
                            <th>ì ìˆ˜ ë¶„í¬</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <!-- ë°ì´í„°ê°€ JavaScriptë¡œ ë™ì  ìƒì„±ë©ë‹ˆë‹¤ -->
                    </tbody>
                </table>
                
                <div id="empty-state" class="empty-state" style="display: none;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                        <polyline points="14,2 14,8 20,8"/>
                        <line x1="16" y1="13" x2="8" y2="13"/>
                        <line x1="16" y1="17" x2="8" y2="17"/>
                        <polyline points="10,9 9,9 8,9"/>
                    </svg>
                    <p>ì•„ì§ ì§„ë‹¨ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                    <p style="font-size: 13px; margin-top: 8px;">ì§ì›ë“¤ì´ ì§„ë‹¨ì„ ì™„ë£Œí•˜ë©´ ì´ê³³ì— í‘œì‹œë©ë‹ˆë‹¤.</p>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        // ê´€ë¦¬ì ì¸ì¦ ì •ë³´
        const ADMIN_CREDENTIALS = {
            department: 'í”¼í”ŒíŒ€',
            name: '20000044'
        };
        
        // DISC ìœ í˜•ë³„ ì •ë³´
        const discTypeInfo = {
            D: { name: "ì£¼ë„í˜•", fullName: "ì£¼ë„í˜• (Dominance)" },
            I: { name: "ì‚¬êµí˜•", fullName: "ì‚¬êµí˜• (Influence)" },
            S: { name: "ì•ˆì •í˜•", fullName: "ì•ˆì •í˜• (Steadiness)" },
            C: { name: "ì‹ ì¤‘í˜•", fullName: "ì‹ ì¤‘í˜• (Conscientiousness)" }
        };
        
        // í•˜ìœ„ ìœ í˜• ì •ë³´
        const subTypeInfo = {
            "Di": "ì˜í–¥ë ¥ ìˆëŠ” ì£¼ë„í˜•",
            "Dc": "ë¶„ì„ì  ì£¼ë„í˜•",
            "Ds": "ì•ˆì •ì  ì£¼ë„í˜•",
            "Id": "ì¶”ì§„ë ¥ ìˆëŠ” ì‚¬êµí˜•",
            "Ic": "ë¶„ì„ì  ì‚¬êµí˜•",
            "Is": "ì•ˆì •ì  ì‚¬êµí˜•",
            "Sd": "ì¶”ì§„ë ¥ ìˆëŠ” ì•ˆì •í˜•",
            "Si": "ì‚¬êµì  ì•ˆì •í˜•",
            "Sc": "ë¶„ì„ì  ì•ˆì •í˜•",
            "Cd": "ì¶”ì§„ë ¥ ìˆëŠ” ì‹ ì¤‘í˜•",
            "Ci": "ì‚¬êµì  ì‹ ì¤‘í˜•",
            "Cs": "ì•ˆì •ì  ì‹ ì¤‘í˜•"
        };
        
        // DOM Elements
        const adminLoginScreen = document.getElementById('admin-login-screen');
        const adminDashboard = document.getElementById('admin-dashboard');
        const adminLoginForm = document.getElementById('admin-login-form');
        const loginError = document.getElementById('login-error');
        const logoutBtn = document.getElementById('logout-btn');
        const tableBody = document.getElementById('table-body');
        const emptyState = document.getElementById('empty-state');
        const totalCount = document.getElementById('total-count');
        const sortSelect = document.getElementById('sort-select');
        const typeFilter = document.getElementById('type-filter');
        const clearDataBtn = document.getElementById('clear-data');
        const downloadExcelBtn = document.getElementById('download-excel');
        
        // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
        function checkAuth() {
            const isLoggedIn = sessionStorage.getItem('adminLoggedIn');
            if (isLoggedIn === 'true') {
                showDashboard();
            }
        }
        
        // ëŒ€ì‹œë³´ë“œ í‘œì‹œ
        function showDashboard() {
            adminLoginScreen.style.display = 'none';
            adminDashboard.classList.add('active');
            renderTable();
        }
        
        // ë¡œê·¸ì¸ ì²˜ë¦¬
        adminLoginForm.addEventListener('submit', (e) => {
            e.preventDefault();
            
            const department = document.getElementById('admin-department').value.trim();
            const name = document.getElementById('admin-name').value.trim();
            
            if (department === ADMIN_CREDENTIALS.department && name === ADMIN_CREDENTIALS.name) {
                sessionStorage.setItem('adminLoggedIn', 'true');
                loginError.style.display = 'none';
                showDashboard();
            } else {
                loginError.style.display = 'block';
            }
        });
        
        // ë¡œê·¸ì•„ì›ƒ
        logoutBtn.addEventListener('click', () => {
            sessionStorage.removeItem('adminLoggedIn');
            adminDashboard.classList.remove('active');
            adminLoginScreen.style.display = 'flex';
            document.getElementById('admin-department').value = '';
            document.getElementById('admin-name').value = '';
        });
        
        // ë‚ ì§œ í¬ë§·íŒ…
        function formatDate(isoString) {
            const date = new Date(isoString);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${year}-${month}-${day} ${hours}:${minutes}`;
        }
        
        // ë°ì´í„° ë¡œë“œ ë° ì •ë ¬
        function loadData() {
            let records = JSON.parse(localStorage.getItem('discRecords') || '[]');
            
            // ìœ í˜• í•„í„°ë§
            const selectedType = typeFilter.value;
            if (selectedType !== 'all') {
                records = records.filter(r => r.resultType === selectedType);
            }
            
            // ì •ë ¬
            const sortBy = sortSelect.value;
            records.sort((a, b) => {
                switch (sortBy) {
                    case 'date-desc':
                        return new Date(b.createdAt) - new Date(a.createdAt);
                    case 'date-asc':
                        return new Date(a.createdAt) - new Date(b.createdAt);
                    case 'name-asc':
                        return a.name.localeCompare(b.name, 'ko');
                    case 'name-desc':
                        return b.name.localeCompare(a.name, 'ko');
                    case 'dept-asc':
                        return a.department.localeCompare(b.department, 'ko');
                    case 'type':
                        return a.resultType.localeCompare(b.resultType);
                    default:
                        return 0;
                }
            });
            
            return records;
        }
        
        // í…Œì´ë¸” ë Œë”ë§
        function renderTable() {
            const records = loadData();
            const allRecords = JSON.parse(localStorage.getItem('discRecords') || '[]');
            
            totalCount.textContent = allRecords.length;
            
            if (records.length === 0) {
                tableBody.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            tableBody.innerHTML = records.map(record => {
                const percentages = record.resultPercentages || {};
                return `
                <tr>
                    <td><strong>${record.name}</strong></td>
                    <td>${record.department}</td>
                    <td>${formatDate(record.createdAt)}</td>
                    <td>
                        <span class="type-badge type-${record.resultType}">${record.resultType}</span>
                        <span style="margin-left: 8px; color: var(--text-secondary); font-size: 13px;">
                            ${discTypeInfo[record.resultType]?.name || ''}
                        </span>
                    </td>
                    <td>
                        <span style="font-weight: 600; color: var(--db-green-dark);">${record.subType || '-'}</span>
                        <span style="display: block; font-size: 12px; color: var(--text-muted);">
                            ${subTypeInfo[record.subType] || ''}
                        </span>
                    </td>
                    <td style="font-size: 12px; color: var(--text-secondary);">
                        D:${percentages.D || 0}% I:${percentages.I || 0}% S:${percentages.S || 0}% C:${percentages.C || 0}%
                    </td>
                </tr>
            `}).join('');
        }
        
        // ì—‘ì…€ ë‹¤ìš´ë¡œë“œ (CSV í˜•ì‹)
        function downloadExcel() {
            const records = JSON.parse(localStorage.getItem('discRecords') || '[]');
            
            if (records.length === 0) {
                alert('ë‹¤ìš´ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            // CSV í—¤ë”
            const headers = ['ì´ë¦„', 'ë¶€ì„œëª…', 'ì§„ë‹¨ì¼ì‹œ', 'DISCìœ í˜•', 'ìœ í˜•ëª…', 'í•˜ìœ„ìœ í˜•', 'í•˜ìœ„ìœ í˜•ëª…', 'Dì ìˆ˜(%)', 'Iì ìˆ˜(%)', 'Sì ìˆ˜(%)', 'Cì ìˆ˜(%)'];
            
            // CSV ë°ì´í„° ìƒì„±
            const csvData = records.map(record => {
                const percentages = record.resultPercentages || {};
                return [
                    record.name,
                    record.department,
                    formatDate(record.createdAt),
                    record.resultType,
                    discTypeInfo[record.resultType]?.name || '',
                    record.subType || '',
                    subTypeInfo[record.subType] || '',
                    percentages.D || 0,
                    percentages.I || 0,
                    percentages.S || 0,
                    percentages.C || 0
                ].map(field => `"${field}"`).join(',');
            });
            
            // BOM ì¶”ê°€ (í•œê¸€ ê¹¨ì§ ë°©ì§€)
            const BOM = '\uFEFF';
            const csvContent = BOM + headers.join(',') + '\n' + csvData.join('\n');
            
            // ë‹¤ìš´ë¡œë“œ
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            
            const now = new Date();
            const dateStr = `${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}`;
            
            link.setAttribute('href', url);
            link.setAttribute('download', `DISCì§„ë‹¨ê²°ê³¼_${dateStr}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }
        
        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        sortSelect.addEventListener('change', renderTable);
        typeFilter.addEventListener('change', renderTable);
        downloadExcelBtn.addEventListener('click', downloadExcel);
        
        clearDataBtn.addEventListener('click', () => {
            if (confirm('ëª¨ë“  ì§„ë‹¨ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                localStorage.removeItem('discRecords');
                renderTable();
            }
        });
        
        // ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', checkAuth);
    </script>
</body>
</html>
